(()=>{var e={};e.id=442,e.ids=[442],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3324:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>h,serverHooks:()=>f,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>k});var o={};t.r(o),t.d(o,{GET:()=>d});var s=t(6559),a=t(8088),n=t(7719),i=t(2190),c=t(4999);let l=process.env.SPOTIFY_CLIENT_ID,u=process.env.SPOTIFY_CLIENT_SECRET,p=process.env.SPOTIFY_REDIRECT_URI||"http://localhost:3000/api/auth/callback";async function d(e){let r=e.nextUrl.searchParams,t=r.get("code"),o=r.get("state"),s=r.get("error"),a=await (0,c.UL)(),n=a.get("spotify_auth_state")?.value;if(s)return console.error("Callback Route - Spotify authorization error:",s),i.NextResponse.redirect(new URL(`/?error=${s}`,e.url));if(!o||o!==n)return console.error("Callback Route - State mismatch error",{state:o,storedState:n}),i.NextResponse.redirect(new URL("/?error=state_mismatch",e.url));if(a.delete("spotify_auth_state"),!t)return console.error("Callback Route - Missing authorization code error"),i.NextResponse.redirect(new URL("/?error=missing_code",e.url));try{if(!l||!u)return console.error("Callback Route - Missing Spotify client credentials on server"),i.NextResponse.redirect(new URL("/?error=missing_credentials",e.url));console.log("Callback Route - Exchanging code for token using redirect URI:",p);let r=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${Buffer.from(`${l}:${u}`).toString("base64")}`},body:new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:p})});if(!r.ok){let t=await r.json(),o=t.error_description||JSON.stringify(t);return console.error("Callback Route - Token exchange failed:",o),i.NextResponse.redirect(new URL(`/?error=token_exchange_failed&details=${encodeURIComponent(o)}`,e.url))}let{access_token:o,refresh_token:s,expires_in:n}=await r.json();return a.set("spotify_access_token",o,{httpOnly:!0,secure:!0,maxAge:n,path:"/"}),a.set("spotify_refresh_token",s,{httpOnly:!0,secure:!0,maxAge:2592e3,path:"/"}),console.log("Callback Route - Successfully obtained tokens and set cookies."),i.NextResponse.redirect(new URL("/dashboard",e.url))}catch(t){console.error("Callback Route - Server error:",t);let r=t instanceof Error?t.message:"Unknown server error";return i.NextResponse.redirect(new URL(`/?error=callback_server_error&message=${encodeURIComponent(r)}`,e.url))}}let h=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/callback/route",pathname:"/api/auth/callback",filename:"route",bundlePath:"app/api/auth/callback/route"},resolvedPagePath:"C:\\Users\\Luke\\Downloads\\fix it\\Spotify-Widget-App\\app\\api\\auth\\callback\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:R,workUnitAsyncStorage:k,serverHooks:f}=h;function g(){return(0,n.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:k})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[80,999,580],()=>t(3324));module.exports=o})();